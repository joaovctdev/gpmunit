<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Controle de Abertura de Turno</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #4e4e4e 0%, #272727 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 30px;
        text-align: center;
      }

      h1 {
        color: #333;
        margin-bottom: 20px;
        font-size: 2em;
      }

      .upload-section {
        margin: 20px 0;
      }

      .file-input-wrapper {
        position: relative;
        display: inline-block;
      }

      input[type="file"] {
        display: none;
      }

      .file-input-label {
        background: linear-gradient(135deg, #008697 0%, #00c3ff 100%);
        color: white;
        padding: 15px 30px;
        border-radius: 8px;
        cursor: pointer;
        display: inline-block;
        font-size: 16px;
        font-weight: bold;
        transition: transform 0.2s;
      }

      .file-input-label:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .file-name {
        margin-left: 15px;
        color: #666;
        font-style: italic;
      }

      .controls {
        margin-top: 20px;
      }

      .btn {
        background: #28a745;
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        margin: 5px;
        transition: all 0.3s;
      }

      .btn:hover {
        background: #218838;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        text-align: center;
      }

      .stat-number {
        font-size: 3em;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .stat-label {
        color: #666;
        font-size: 1.1em;
      }

      .stat-card.total .stat-number {
        color: #667eea;
      }

      .stat-card.aberto .stat-number {
        color: #28a745;
      }

      .stat-card.falta .stat-number {
        color: #dc3545;
      }

      .results {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .results h2 {
        color: #333;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 3px solid #667eea;
      }

      .team-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 12px;
        margin-top: 20px;
      }

      /* Layout para PNG - mais largo */
      .png-layout .team-grid {
        grid-template-columns: repeat(4, 1fr);
      }

      .team-card {
        padding: 15px 20px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 500;
        transition: transform 0.2s;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .team-card:hover {
        transform: translateX(5px);
      }

      .team-card.aberto {
        background: #d4edda;
        border-left: 5px solid #28a745;
        color: #155724;
      }

      .team-card.falta {
        background: #f8d7da;
        border-left: 5px solid #dc3545;
        color: #721c24;
      }

      .status-badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
      }

      .team-card.aberto .status-badge {
        background: #28a745;
        color: white;
      }

      .team-card.falta .status-badge {
        background: #dc3545;
        color: white;
      }

      .section {
        margin-bottom: 30px;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 20px;
        color: #667eea;
        font-size: 18px;
      }

      .loading.active {
        display: block;
      }

      @media print {
        body {
          background: white;
        }
        .controls {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Controle de Abertura de Turno</h1>
        <div class="upload-section">
          <div class="file-input-wrapper">
            <input type="file" id="fileInput" accept=".xlsx,.xls" />
            <label for="fileInput" class="file-input-label">
              üìÅ Selecionar Planilha Excel
            </label>
            <span class="file-name" id="fileName"
              >Nenhum arquivo selecionado</span
            >
          </div>
        </div>
        <div class="controls">
          <button class="btn" id="downloadBtn" disabled>
            üì• Baixar como PNG
          </button>
        </div>
      </div>

      <div class="loading" id="loading">Processando planilha...</div>

      <div id="statsSection" style="display: none">
        <div class="stats">
          <div class="stat-card total">
            <div class="stat-number" id="totalEquipes">0</div>
            <div class="stat-label">Total de Equipes</div>
          </div>
          <div class="stat-card aberto">
            <div class="stat-number" id="totalAberto">0</div>
            <div class="stat-label">Turnos Abertos</div>
          </div>
          <div class="stat-card falta">
            <div class="stat-number" id="totalFalta">0</div>
            <div class="stat-label">Faltam Abrir</div>
          </div>
        </div>
      </div>

      <div id="resultsSection" style="display: none">
        <div class="results" id="captureArea">
          <div class="section">
            <h2>‚úÖ Turnos Abertos (<span id="countAberto">0</span>)</h2>
            <div class="team-grid" id="abertoList"></div>
          </div>

          <div class="section">
            <h2>‚ùå Faltam Abrir Turno (<span id="countFalta">0</span>)</h2>
            <div class="team-grid" id="faltaList"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Lista de todas as equipes
      const todasEquipes = [
        "ESMERALDO DOS SANTOS OLIVEIRA",
        "ENES RAMOS DA SILVA",
        "FELIPE PEREIRA ALVES",
        "IRISMAR MARQUES SILVA",
        "JAILSON SANTOS SILVA",
        "JARBAS SOUZA AMORIM",
        "VANILSON LUCIO DOS SANTOS SILVA",
        "WILIAN DA SILVA SENA",
        "EDILSON DE SOUZA SANTOS",
        "ALEX SANDRO SANTOS BISPO",
        "EDMILSON RIBEIRO DO NASCIMENTO",
        "VANDERLEI DE MENEZES SEVERO",
        "WESLEY REIS DE OLIVEIRA",
        "MARCOS PAULO CARDOSO",
        "GIORLAN EVANGELISTA SOUZA",
        "GABRIEL DOS SANTOS SILVA",
        "WASHINGTON ALVES OLIVEIRA",
        "ALAN NUNES BARRETO",
        "REVERTON BASTOS ROCHA NOVAIS",
        "ELIEZER BATISTA",
        "UBERDAN CERQUEIRA DA SILVA",
        "ROMERO DIAS SILVA",
        "RIAN LUCAS FERREIRA OLIVEIRA",
        "DOUGLAS DA SILVA MELO",
        "RODRIGO SANTOS SILVA",
        "JAILTON DA SILVA",
        "GERALDO DA COSTA GOMES",
        "CLEBSON REIS NETO",
        "DIOGO CRUZ DOS SANTOS",
        "LUCIANO NUNES DA SILVA",
        "FABIANO LOPES DE MORAES",
        "AMILTON FERNANDO ALVES COSTA",
        "EMERSON DE CARVALHO SILVA",
        "PATRICIO DA SILVA BARBOSA",
        "JULIO SERAFIM DAMACENO DOS SANTOS",
        "VALMIR ALVES DA SILVA",
        "CARLOS DA CRUZ SANTANA",
        "JENILSON ALVES OLIVEIRA",
        "JOAO PEREIRA DA SILVA",
        "OSIMAR OLIVEIRA SOUZA",
        "CARLOS ANDRE SANTOS DA SILVA",
        "JAIR DE JESUS",
        "TIAGO BARBOZA DE SOUZA",
        "CAIQUE SILVA LIMA",
      ];

      const fileInput = document.getElementById("fileInput");
      const fileName = document.getElementById("fileName");
      const downloadBtn = document.getElementById("downloadBtn");
      const loading = document.getElementById("loading");

      fileInput.addEventListener("change", handleFileSelect);
      downloadBtn.addEventListener("click", downloadAsPNG);

      function handleFileSelect(event) {
        const file = event.target.files[0];
        if (!file) return;

        fileName.textContent = file.name;
        loading.classList.add("active");

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: "array" });

            // Pega a primeira planilha
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(firstSheet, {
              header: 1,
            });

            processarDados(jsonData);
            loading.classList.remove("active");
            downloadBtn.disabled = false;
          } catch (error) {
            alert("Erro ao processar planilha: " + error.message);
            loading.classList.remove("active");
          }
        };
        reader.readAsArrayBuffer(file);
      }

      function normalizarNome(nome) {
        if (!nome) return "";
        return String(nome)
          .toUpperCase()
          .trim()
          .normalize("NFD")
          .replace(/[\u0300-\u036f]/g, ""); // Remove acentos
      }

      function processarDados(data) {
        // Extrai os nomes da planilha (assumindo que est√£o em alguma coluna)
        const nomesNaPlanilha = new Set();

        // Procura em todas as c√©lulas por nomes que correspondam √†s equipes
        data.forEach((row) => {
          row.forEach((cell) => {
            if (cell) {
              const cellNormalizado = normalizarNome(cell);
              todasEquipes.forEach((equipe) => {
                const equipeNormalizada = normalizarNome(equipe);
                if (
                  cellNormalizado.includes(equipeNormalizada) ||
                  equipeNormalizada.includes(cellNormalizado)
                ) {
                  nomesNaPlanilha.add(equipe);
                }
              });
            }
          });
        });

        // Separa quem abriu e quem falta
        const equipesAbriram = Array.from(nomesNaPlanilha).sort();
        const equipasFaltam = todasEquipes
          .filter((eq) => !nomesNaPlanilha.has(eq))
          .sort();

        // Atualiza a interface
        atualizarInterface(equipesAbriram, equipasFaltam);
      }

      function atualizarInterface(abriram, faltam) {
        // Atualiza estat√≠sticas
        document.getElementById("totalEquipes").textContent =
          todasEquipes.length;
        document.getElementById("totalAberto").textContent = abriram.length;
        document.getElementById("totalFalta").textContent = faltam.length;
        document.getElementById("countAberto").textContent = abriram.length;
        document.getElementById("countFalta").textContent = faltam.length;

        // Lista de quem abriu
        const abertoList = document.getElementById("abertoList");
        abertoList.innerHTML = abriram
          .map(
            (nome) => `
                <div class="team-card aberto">
                    <span>${nome}</span>
                    <span class="status-badge">ABERTO</span>
                </div>
            `
          )
          .join("");

        // Lista de quem falta
        const faltaList = document.getElementById("faltaList");
        faltaList.innerHTML = faltam
          .map(
            (nome) => `
                <div class="team-card falta">
                    <span>${nome}</span>
                    <span class="status-badge">FALTA</span>
                </div>
            `
          )
          .join("");

        // Mostra as se√ß√µes
        document.getElementById("statsSection").style.display = "block";
        document.getElementById("resultsSection").style.display = "block";
      }

      function downloadAsPNG() {
        const captureArea = document.getElementById("captureArea");

        // Cria um container tempor√°rio com tudo que queremos capturar
        const tempContainer = document.createElement("div");
        tempContainer.className = "png-layout";
        tempContainer.style.cssText =
          'position: absolute; left: -9999px; background: white; padding: 40px; width: 1600px; font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;';

        // Adiciona t√≠tulo com data e hora
        const agora = new Date();
        const dataFormatada = agora.toLocaleDateString("pt-BR", {
          day: "2-digit",
          month: "2-digit",
          year: "numeric",
        });
        const horaFormatada = agora.toLocaleTimeString("pt-BR", {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });

        const title = document.createElement("h1");
        title.textContent = "Controle de Abertura de Turno";
        title.style.cssText =
          "color: #333; margin-bottom: 10px; font-size: 2.2em; text-align: center;";
        tempContainer.appendChild(title);

        const timestamp = document.createElement("p");
        timestamp.textContent = `Relat√≥rio do dia: ${dataFormatada} √†s ${horaFormatada}`;
        timestamp.style.cssText =
          "color: #666; margin-bottom: 30px; font-size: 1.1em; text-align: center; font-weight: 500;";
        tempContainer.appendChild(timestamp);

        // Clona e estiliza apenas os resultados
        const resultsClone = captureArea.cloneNode(true);
        resultsClone.style.cssText =
          "background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);";

        // Aplica estilos aos elementos clonados
        const h2Elements = resultsClone.querySelectorAll("h2");
        h2Elements.forEach((h2) => {
          h2.style.cssText =
            "color: #333; margin-bottom: 20px; margin-top: 20px; padding-bottom: 10px; border-bottom: 3px solid #667eea; font-size: 1.5em;";
        });

        const teamGrids = resultsClone.querySelectorAll(".team-grid");
        teamGrids.forEach((grid) => {
          grid.style.cssText =
            "display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 20px;";
        });

        const teamCards = resultsClone.querySelectorAll(".team-card");
        teamCards.forEach((card) => {
          card.style.cssText +=
            "padding: 12px 15px; border-radius: 8px; font-size: 14px; font-weight: 500; display: flex; align-items: center; justify-content: space-between;";
        });

        tempContainer.appendChild(resultsClone);
        document.body.appendChild(tempContainer);

        // Aguarda um pouco para garantir que os estilos foram aplicados
        setTimeout(() => {
          html2canvas(tempContainer, {
            backgroundColor: "#ffffff",
            scale: 1.5,
            width: 1600,
            logging: false,
            useCORS: true,
          }).then((canvas) => {
            const link = document.createElement("a");
            const dataAtual = new Date().toISOString().split("T")[0];
            const horaAtual = new Date()
              .toTimeString()
              .split(" ")[0]
              .replace(/:/g, "-");
            link.download = `controle_turno_${dataAtual}_${horaAtual}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();

            // Remove o container tempor√°rio
            document.body.removeChild(tempContainer);
          });
        }, 100);
      }
    </script>
  </body>
</html>
